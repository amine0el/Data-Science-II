{% extends "mgcapp/layout.html" %}

{% load static %}
{% load bootstrap5 %}
{% block title %}

{% endblock %}
{% block content %}
<div class="container text-center">
  <div class="row">
    <div class="col">
      <img src="media/logo_data_science.png" alt="logo">
    </div>
    <div class="col-6">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {% if not uploaded_file_url %}
        <div class="mb-3" align="center">
          <label for="formFile" class="form-label">Input your file</label>
          <input class="form-control" type="file" id="formFile" name="myfile">
        </div>
        <div class="mb-3" align="center">
          <button type="submit" class="btn btn-primary" name="type" value="file">Upload</button>
        </div>
        {% endif %}

        {% if uploaded_file_url %}
        <p>Thank you for the upload. We need extract necessary features out of the Song to recommend a genre. This will take a while...</p>
        <div class='progress-wrapper'>
          <div id='progress-bar' class='progress-bar' style="background-color: #68a9ef; width: 0%;">&nbsp;</div>
        </div>
        <div id="progress-bar-message">Waiting for the feature extraction to start...</div>
        <script src="{% static 'celery_progress/celery_progress.js' %}"></script>
        <script>
        var progressUrl = "{% url 'celery_progress:task_status' task_id %}";
      
        function customResult(resultElement, result) {
          $( resultElement ).append(
             $('<p>').text('Sum of all seconds is ' + result)
          );
          window.location.replace("http://localhost:8006/prediction");
        }
      
      
        CeleryProgressBar.initProgressBar(progressUrl, {
              onResult: customResult,
        })
      
      </script>
        
      {% if task_id == 100 %}
        <div class="mb-3" align="center">
          <button type="submit" class="btn btn-primary" name="type" value="genre">Get predicted Genre</button>
        </div>
      {% endif %}
        {% endif %}
        
        
        {% if format_error %}
        <p>
        <pre><b>{{ format_error }}</b></pre>
        </p>
        {% endif %}

        <p><a href="{% url 'home' %}">Return to home</a></p>
    </div>
    <div class="col">
    </div>
  </div>
</div>

{% endblock %}